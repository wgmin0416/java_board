<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <!-- 
    xmlns:th="http://www.thymeleaf.org"
    - Thymeleaf 네임스페이스 선언
    - th: 접두사를 사용할 수 있게 해줌
-->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시판 목록</title>
    <!-- CSS 파일 연결 -->
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <!-- 
        th:href="@{/css/style.css}"
        - @{}: Thymeleaf URL 표현식
        - /css/style.css → 실제 경로: src/main/resources/static/css/style.css
    -->
  </head>
  <body>
    <div class="container">
      <!-- 헤더: 제목과 글쓰기 버튼 -->
      <header>
        <h1>게시판</h1>
        <!-- 
                th:href="@{/boards/new}"
                - /boards/new URL로 링크 생성
                - 클릭하면 게시글 작성 페이지로 이동
            -->
        <a th:href="@{/boards/new}" class="btn btn-primary">글쓰기</a>
      </header>

      <!-- 검색 폼 -->
      <div class="search-form">
        <form th:action="@{/boards}" method="get" class="search-container">
          <div class="search-input-group">
            <!-- 검색 타입 선택 -->
            <select name="searchType" class="search-type-select">
              <option value="title" th:selected="${searchType == 'title'}">제목</option>
              <option value="content" th:selected="${searchType == 'content'}">내용</option>
              <option value="title+content" th:selected="${searchType == 'title+content' or searchType == null}">제목+내용</option>
              <option value="author" th:selected="${searchType == 'author'}">작성자</option>
            </select>
            
            <!-- 검색 키워드 입력 -->
            <input 
              type="text" 
              name="keyword" 
              placeholder="검색어를 입력하세요" 
              class="search-input"
              th:value="${keyword}"
            />
            
            <!-- 검색 버튼 -->
            <button type="submit" class="btn btn-search">검색</button>
            
            <!-- 검색 초기화 버튼 (검색 중일 때만 표시) -->
            <a 
              th:if="${keyword != null and !keyword.isEmpty()}" 
              th:href="@{/boards}" 
              class="btn btn-secondary"
            >
              초기화
            </a>
          </div>
        </form>
      </div>

      <!-- 게시글 목록 테이블 -->
      <div class="board-list">
        <table>
          <thead>
            <tr>
              <th style="width: 10%">번호</th>
              <th style="width: 50%">제목</th>
              <th style="width: 15%">작성자</th>
              <th style="width: 15%">작성일</th>
              <th style="width: 10%">관리</th>
            </tr>
          </thead>
          <tbody>
            <!-- 
                        th:if="${boards.empty}"
                        - boards가 비어있으면 이 <tr>를 표시
                        - 게시글이 없을 때 메시지 출력
                    -->
            <tr th:if="${boards.empty}">
              <td colspan="5" class="text-center">등록된 게시글이 없습니다.</td>
            </tr>

            <!-- 
                        th:each="board : ${boards.content}"
                        - boards.content 리스트를 순회
                        - 각 게시글을 board 변수에 담아서 반복
                        - Java의 for-each와 유사: for (Board board : boards.content)
                    -->
            <tr th:each="board : ${boards.content}">
              <!-- 
                            th:text="${board.id}"
                            - board.getId()를 호출해서 값을 출력
                            - <td>1</td> 같은 형태로 렌더링됨
                        -->
              <td th:text="${board.id}"></td>
              <td>
                <!-- 
                                th:href="@{/boards/{id}(id=${board.id})}"
                                - 경로 변수 사용
                                - {id} 부분이 ${board.id} 값으로 치환됨
                                - 예: /boards/1, /boards/2
                                
                                th:text="${board.title}"
                                - 제목을 텍스트로 출력
                            -->
                <a
                  th:href="@{/boards/{id}(id=${board.id})}"
                  th:text="${board.title}"
                ></a>
              </td>
              <td th:text="${board.author}"></td>
              <!-- 
                            ${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}
                            - 날짜 포맷팅
                            - LocalDateTime을 "2026-01-03 12:30" 형식으로 변환
                            - #temporals: Thymeleaf의 날짜/시간 유틸리티
                        -->
              <td
                th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}"
              ></td>
              <td>
                <!-- 수정 버튼 -->
                <a
                  th:href="@{/boards/{id}/edit(id=${board.id})}"
                  class="btn btn-sm btn-edit"
                  >수정</a
                >
                <!-- 
                                삭제 폼
                                - POST 방식으로 삭제 요청
                                - onsubmit: 폼 제출 전 확인 메시지 표시
                            -->
                <form
                  th:action="@{/boards/{id}/delete(id=${board.id})}"
                  method="post"
                  style="display: inline"
                  onsubmit="return confirm('정말 삭제하시겠습니까?');"
                >
                  <button type="submit" class="btn btn-sm btn-delete">
                    삭제
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 페이징 -->
      <!-- 
            th:if="${boards.totalPages > 0}"
            - 전체 페이지가 0보다 크면 페이징 영역 표시
        -->
      <div class="pagination" th:if="${boards.totalPages > 0}">
        <!-- 페이징 정보 -->
        <div class="pagination-info">
          <!-- 
                    th:text="${boards.totalElements}"
                    - 전체 게시글 개수 출력
                -->
          <span>총 <strong th:text="${boards.totalElements}">0</strong>개</span>
          <span
            >페이지 <strong th:text="${boards.number + 1}">1</strong> /
            <strong th:text="${boards.totalPages}">1</strong></span
          >
        </div>

        <!-- 페이징 컨트롤 -->
        <div class="pagination-controls">
          <!-- 이전 페이지 화살표 -->
          <!-- 
                    th:if="${boards.hasPrevious()}"
                    - 이전 페이지가 있으면 링크 표시
                    - 없으면 비활성화된 화살표 표시
                -->
          <a
            th:if="${boards.hasPrevious()}"
            th:href="@{/boards(page=${boards.number - 1}, keyword=${keyword}, searchType=${searchType})}"
            class="page-arrow"
            >‹</a
          >
          <span th:unless="${boards.hasPrevious()}" class="page-arrow disabled"
            >‹</span
          >

          <!-- 페이지 번호 (현재 페이지 기준 최대 10개) -->
          <!-- 
                    th:with: 지역 변수 선언
                    - startPage: 시작 페이지 번호 계산
                    - endPage: 끝 페이지 번호 계산
                    - T(java.lang.Math): Java의 Math 클래스 사용
                    - 주의: th:with는 한 줄에 작성해야 파싱 오류가 발생하지 않습니다
                -->
          <th:block
            th:with="startPage=${T(java.lang.Math).max(0, boards.number - 4)}, endPage=${T(java.lang.Math).min(boards.totalPages - 1, boards.number + 5)}"
          >
            <!-- 
                        th:each="pageNum : ${#numbers.sequence(startPage, endPage)}"
                        - startPage부터 endPage까지 숫자 시퀀스 생성
                        - 예: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
                    -->
            <th:block
              th:each="pageNum : ${#numbers.sequence(startPage, endPage)}"
            >
              <!-- 
                            th:if="${pageNum == boards.number}"
                            - 현재 페이지면 active 클래스 추가 (강조 표시)
                        -->
              <a
                th:if="${pageNum == boards.number}"
                th:href="@{/boards(page=${pageNum}, keyword=${keyword}, searchType=${searchType})}"
                class="page-number active"
                th:text="${pageNum + 1}"
              ></a>
              <!-- 
                            th:unless: if의 반대 (조건이 false일 때)
                            - 현재 페이지가 아니면 일반 스타일
                        -->
              <a
                th:unless="${pageNum == boards.number}"
                th:href="@{/boards(page=${pageNum}, keyword=${keyword}, searchType=${searchType})}"
                class="page-number"
                th:text="${pageNum + 1}"
              ></a>
            </th:block>
          </th:block>

          <!-- 다음 페이지 화살표 -->
          <a
            th:if="${boards.hasNext()}"
            th:href="@{/boards(page=${boards.number + 1}, keyword=${keyword}, searchType=${searchType})}"
            class="page-arrow"
            >›</a
          >
          <span th:unless="${boards.hasNext()}" class="page-arrow disabled"
            >›</span
          >
        </div>
      </div>
    </div>
  </body>
</html>
